{
  "hash": "55688cabf517e6571015ea069e720516",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ordinal Logistic Regression\"\nsubtitle: \"DIY Ordinal Logistic Regression in R\"\ntitle-block-banner: true\ndate: \"2024-07-03\"\nauthor: \n  - name: \"Sultana Mubarika Rahman Chowdhury\"\n    affiliations: \n       - Robert Stemple College of Public Health\n       - Florida Internationa University\nformat:\n  html:\n    self-contained: true \n    code-fold: true\n    html-math-method: katex\n    theme: minty\n    \nknitr:\n  opts_chunk:      ########## set global options ############\n    collapse: true # keep code from blocks together (if shown)\n    echo: true    # don't show code\n    message: true  # show messages\n    warning: FALSE  # show warnings\n    error: true    # show error messages\n    comment: \"\"    # don't show ## with printed output\n    R.options:    \n      digits: 3    # round to three digits\neditor: visual\nbibliography: [references.bib, packages.bib]\ncsl: the-new-england-journal-of-medicine.csl\n\ntoc: TRUE\n---\n\n\n# Introduction to Logistic Regression\n\nWe are all familiar with the concept of Logistic regression. It is used to analyze data when the outcome variables is categorical. There are three types of logistic regression, Binary logistic regression where the outcome variable is binary (Yes/No), Multinomial logistic regression when the outcome variable is categorical with three or more categories, Ordinal logistic regression where there is a natural ordering among three or more categories of the outcome variable[@agresti2002] .\n\n**Title: Types of Logistic Regression**\n\n|                                     | Binary LR | Multinomial LR | Ordinal LR    |\n|-------------------|------------------|------------------|------------------|\n| Number of categories of the outcome | Two       | Three or more  | Three or more |\n| Ordering matters                    | No        | No             | Yes           |\n\n# What is Ordinal Logistic Regression\n\nOrdinal logistic regression is a statistical modeling technique used to investigate relationships between predictor variables and ordered ordinal outcome variables. It extends traditional logistic regression to account for the response variable's inherent ordering, making it suitable for situations where the outcome has multiple levels with unequal intervals.\n\nFor example, cases when ordinal logistic regression can be applicable are,\n\n-   Likelihood of agreement : In a survey the responses to the outcome variable is categorized in multiple levels such as, Strongly Disagree, Disagree, Agree, Strongly Agree.\n-   Satisfaction level: Measuring satisfaction level of a service on a scale like, \"very dissatisfied,\" \"dissatisfied,\" \"neutral,\" \"satisfied,\" and \"very satisfied.\"\n-   Pain Intensity: Patients participating in medical research may be asked to rate the intensity of their pain on a scale ranging from \"no pain\" to \"mild pain,\" \"moderate pain,\" and \"severe pain.\"\n\n# How to do Ordinary Logistic Regression in R\n\nSome popular R packages that perform Ordinal/Ordered Logistic Regression are,\n\n-   `MASS` package : function `polr()`\n\n-   `ordinal` package: function `clm()`\n\n-   `rms` package: function `orm()`\n\nIn this demonstration I will be using `polr()` from `MASS` package to conduct the analysis.\n\n# Mathematical Formulation of a Ordinal model\n\nLet us assume Y is an outcome variable with levels, l = 1, 2, ... , L. According to the `MASS` package the parameterization of the outcome variable Y with l levels is,\n\n$$\nln(\\frac{P(Y\\le l)}{P(Y>l)}) =\\zeta - \\eta_{1}X_{1}- \\eta_{2}X_{2} - … - \\eta_{k}X_{k}\n$$\n\nHere,\n\n-   $\\zeta$ is the intercept representing the log-odds of $Y$ being less than or equal to $l$ when the other covariates are 0 or in there reference level. Ordinal logistic regression model has one intercept for each level of Y and the total number of intercepts is $L-1$.\n\n<!-- -->\n\n-   In case of categorical predictors, each coefficient $- \\eta_{k}$ is the log of odds ratio comparing the odds of $Y\\le l$ at a level compared to the reference category. Taking exponent of this term we get $e^{\\eta_{k}}$ which is the odds ratio comparing the odds of $Y\\le l$ at a level compared to the reference category.\n\n-   In case of continuous predictors, each coefficient $- \\eta_{k}$ is the log of odds ratio comparing the odds of $Y\\le l$ between subjects who differ by 1 unit. Taking exponent of this term we get $e^{\\eta_{k}}$ which is the odds ratio comparing the odds of $Y\\le l$ between subjects who differ by 1 unit.\n\nSimilar to binary logistic regression the left hand side of this equation is the log-odds of a probability. In case of binary logistic regression it is log-odds of probability of an event whereas here we consider the cumulative probability upto and a specified level including that level.\n\n## Model Assumptions\n\nThe key assumptions of Ordinary logistic Regression which ensures the validity of the model are as follows,\n\n-   The outcome variable is ordered.\n\n-   The predictor variables are either continuous, categorical or ordinal.\n\n-   There is no multicollinearity among the predictors.\n\n-   Proportional odds.\n\n# Example\n\nTo demonstrate the methods I will be using the `arthritis` data from `multgee` package. The data has Rheumatoid self-assessment scores for 302 patients, measured on a five-level ordinal response scale at three follow-up times.\n\nThe dataset has these 7 variables, A data frame with 906 observations on the following 7 variables:\n\n-   **id** : Patient identifier variable.\n\n-   **y :** Self-assessment score of rheumatoid arthritis measured on a five-level ordinal response scale, 1 being the lowest.\n\n-   **sex :** Coded as (1) for female and (2) for male.\n\n-   **age :** Recorded at the baseline.\n\n-   **trt :** Treatment group variable, coded as (1) for the placebo group and (2) for the drug group.\n\n-   **baseline** : Self-assessment score of rheumatoid arthritis at the baseline.\n\n-   **time** : Follow-up time recorded in months.\n\n## Libraries\n\nHere are libraries required to run the analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"multgee\")\n# install.packages(\"pander\")\n# install.packages(\"table1\")\n# install.packages(\"car\")\nlibrary(table1)\nError in library(table1): there is no package called 'table1'\nlibrary(multgee)\nError in library(multgee): there is no package called 'multgee'\nlibrary(skimr)\nError in library(skimr): there is no package called 'skimr'\nlibrary(pander)\nError in library(pander): there is no package called 'pander'\nlibrary(gtsummary)\nError in library(gtsummary): there is no package called 'gtsummary'\nlibrary(car)\nError in library(car): there is no package called 'car'\nlibrary(table1)\nError in library(table1): there is no package called 'table1'\nlibrary(conflicted)\nsuppressMessages(conflict_prefer(\"filter\", \"dplyr\", quiet = TRUE))\nsuppressPackageStartupMessages(library(tidyverse))\n# suppress \"`summarise()` has grouped output by \" messages\noptions(dplyr.summarise.inform = F)\n```\n:::\n\n\n### Warning\n\nInstead of installing package `MASS` to the global environment use `MASS::polr()` for running the Ordinal Logistic Regression model. As masking it conflicts wirh the `select()` function for `tidyverse` and `gtsummary()`.\n\n## Exploring data\n\nLet's begin by looking at the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading data\n\narthritis_df <- multgee::arthritis\nError in loadNamespace(x): there is no package called 'multgee'\n\ndf <- arthritis_df %>%\n  mutate(\n    y = as.factor(y),\n    sex = factor(sex,\n      levels = c(1, 2),\n      labels = c(\"Female\", \"Male\")\n    ),\n    treatment = factor(trt,\n      levels = c(\"1\", \"2\"),\n      labels = c(\"Placebo\", \"Drug\")\n    ),\n    baseline = factor(baseline)\n  ) %>%\n  select(\"y\", \"sex\", \"age\", \"treatment\", \"baseline\") %>%\n  drop_na()\nError in eval(expr, envir, enclos): object 'arthritis_df' not found\n```\n:::\n\n\n### Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(df)\nError in skim(df): could not find function \"skim\"\n```\n:::\n\n\n### Descriptives\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_summary(df, by = treatment) %>%\n  modify_caption(\"**Table 1. Predictors by treatment group**\")\nError in modify_caption(., \"**Table 1. Predictors by treatment group**\"): could not find function \"modify_caption\"\n```\n:::\n\n\n### Plotting Outcome variable (rheumatoid arthritis score)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  ggplot(\n    .,\n    aes(y)\n  ) +\n  geom_bar(aes(y = after_stat(count) / sum(after_stat(count))), position = \"dodge\") +\n  scale_y_continuous(labels = scales::percent) +\n  ylab(\"realtive frequencies\") +\n  xlab(\"score\")\nError in `ggplot()`:\n! `data` cannot be a function.\nℹ Have you misspelled the `data` argument in `ggplot()`\n```\n:::\n\n\n## How to use `Polr()`\n\nThe basic structure of the function looks like this:\n\n`polr(formula, data, weights, start, ..., subset, na.action, contrasts = NULL, Hess = FALSE, model = TRUE, method = c(\"logistic\", \"probit\", \"loglog\", \"cloglog\", \"cauchit\"))`\n\nHere,\n\n-   `formula` a formula expression as for regression models, of the form response \\~ predictors. The response should be a factor (preferably an ordered factor), which will be interpreted as an ordinal response, with levels ordered as in the factor. The model must have an intercept: attempts to remove one will lead to a warning and be ignored. An offset may be used. See the documentation of formula for other details.\n\n-   `data` an optional data frame, list or environment in which to interpret the variables occurring in formula.\n\n-   `weights` optional case weights in fitting. Default to 1.\n\n-   `start` initial values for the parameters. This is in the format c(coefficients, zeta): see the Values section.\n\n-   `...` additional arguments to be passed to optim, most often a control argument.\n\n-   `subset` expression saying which subset of the rows of the data should be used in the fit. All observations are included by default.\n\n-   `na.action` a function to filter missing data.\n\n-   `contrasts` a list of contrasts to be used for some or all of the factors appearing as variables in the model formula.\n\n-   `Hess` logical for whether the Hessian (the observed information matrix) should be returned. Use this if you intend to call summary or variance covariance on the fit.\n\n-   `model` logical for whether the model matrix should be returned.\n\n-   `method` logistic or probit or (complementary) log-log or cauchit (corresponding to a Cauchy latent variable).\n\n## Fitting the model\n\nUsing this function lets fit the data,\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## fitting the model\n\nfit_olr_mod <-\n  MASS::polr(y ~ ., data = df, Hess = T)\nError in model.frame.default(formula = y ~ ., data = df): 'data' must be a data.frame, environment, or list\n\npander(summary(fit_olr_mod))\nError in pander(summary(fit_olr_mod)): could not find function \"pander\"\n```\n:::\n\n\nThe function gives us the coefficients, intercepts along with their standard error and t statistic.\n\n## Odds Ratio\n\nIn order to get the Odds Ratio and their confidence interval we take the exponential of the coefficient. There is no straight forward way of doing that in `R`. Below is one way of solving that issue.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Odds ratio and Confidence Interval\n\nCI <- confint(fit_olr_mod)\nError in eval(expr, envir, enclos): object 'fit_olr_mod' not found\nresults <- data.frame(\n  Variable = c(\n    \"sex_male\", \"age\", \"treatment_drug\", \"baseline_2\", \"baseline_3\", \"baseline_4\",\n    \"baseline_5\"\n  ),\n  OR = exp(fit_olr_mod$coefficients),\n  lower = exp(CI[, 1]),\n  upper = exp(CI[, 2])\n)\nError in eval(expr, envir, enclos): object 'fit_olr_mod' not found\nodds_ratio <- results %>% tibble()\nError in eval(expr, envir, enclos): object 'results' not found\npander(odds_ratio)\nError in pander(odds_ratio): could not find function \"pander\"\n```\n:::\n\n\n## Interpreting the Results\n\n-   *Sex:* Compared to female participants, Male participants had 1.16 fold higher odds of reporting high score of rheumatoid arthritis\n\n-   *Age:* For 1 year change in age the odds of reporting high rheumatoid arthritis score changes 0.99 times.\n\n-   *Treatment:* Compared to the Placebo group participants, the participant who received the drug had 1.73 times higher odds of reporting high score of rheumatoid arthritis.\n\n## Checking Assumptions\n\nNext we check the key assumptions to verify whether the model is appropriate to use.\n\n### Multicollinearity\n\n#### Pairs Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## model assumption\n\n# Pairs plot to check multicollinearity\ndf %>%\n  GGally::ggpairs()\nError in loadNamespace(x): there is no package called 'GGally'\n```\n:::\n\n\nAs there is only have one continuous variable the `pairs` plot is not that useful. So instead let's check the pairwise correlation among predictors.\n\n#### Correlation Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\narthritis_df %>%\n  GGally::ggcorr(\n    method = c(\"pairwise\"),\n    label = TRUE\n  ) # low cor coft, may assume no multicollinearity\nError in loadNamespace(x): there is no package called 'GGally'\n```\n:::\n\n\nThe correlation is quite low among the predictors so there is no multicollinearity.\n\n### Proportional Odds\n\nOrdinal logistic regression makes the assumption that the relationship between each pair of outcome groups is the same. In other words, ordinal logistic regression assumes that the coefficients describing the relationship between, say, the lowest and all higher categories of the response variable are the same as those describing the relationship between the next lowest and all higher categories, and so on. This assumption can be vefied several way. Here, I have used a package called [@pomcheckr] that generates graphics to check for proportional odds assumption created by UCLA statistical consulting group \\[see more\\](https://stats.oarc.ucla.edu/) .\n\n#### Graphics to check for proportional odds\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"pomcheckr\")\nlibrary(pomcheckr)\nError in library(package, pos = pos, lib.loc = lib.loc, character.only = TRUE, : there is no package called 'pomcheckr'\npomchk <-\n  pomcheck(y ~ sex + age + treatment + baseline, data = df)\nError in pomcheck(y ~ sex + age + treatment + baseline, data = df): could not find function \"pomcheck\"\nplot(pomchk)\nError in eval(expr, envir, enclos): object 'pomchk' not found\n```\n:::\n\n\nHere the function is calculating the difference in proportion of the categories in the outcome variable and plotting them against each category of the predictors. In idea case scinario is the distance between the dots in each line is somewhat equal they will be considered proportional.\n\n\n\n# References {.unnumbered}\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}